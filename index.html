<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>感知模擬器：觸控修復版</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <style>
        /* 強制關閉所有瀏覽器預設手勢 */
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; overflow: hidden; 
            touch-action: none; -webkit-user-select: none; 
        }
        
        #bg {
            position: fixed; width: 100vw; height: 100vh;
            background: url('433436.jpg') no-repeat center bottom;
            background-size: cover; filter: grayscale(0.5) blur(2px); 
            z-index: 1; transform: scale(0.9);
        }

        #vignette { position: fixed; width: 100%; height: 100%; top: 0; left: 0; background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.95) 100%); z-index: 10; pointer-events: none; }
        #clock { position: fixed; top: 20px; right: 20px; color: #fff; font-size: 1.2rem; z-index: 20; }
        
        /* 核心修復：確保搖桿在最前面 */
        #joy-base { 
            position: fixed; bottom: 12%; left: 10%; 
            width: 120px; height: 120px; 
            background: rgba(255,255,255,0.3); 
            border-radius: 50%; 
            z-index: 9999; /* 最高的圖層 */
            border: 3px solid #fff;
            touch-action: none; /* 強制不准有其他動作 */
        }
        #joy-knob { 
            position: absolute; width: 50px; height: 50px; 
            background: #fff; border-radius: 50%; 
            left: 35px; top: 35px; 
            pointer-events: none; /* 讓點擊穿透到底座 */
        }
        
        #btn { 
            position: fixed; bottom: 12%; right: 10%; 
            padding: 15px 25px; background: #e74c3c; 
            color: white; border: none; border-radius: 50px; 
            z-index: 9999; font-weight: bold;
        }

        .whisper { position: fixed; color: #fff; z-index: 5; pointer-events: none; animation: fade 2s forwards; font-weight: bold; }
        @keyframes fade { 0% { opacity: 1; } 100% { opacity: 0; transform: translateY(-30px); } }
    </style>
</head>
<body onclick="spawnText(event)">

    <div id="bg"></div>
    <div id="vignette"></div>
    <div id="clock">14:23:05</div>
    <div id="joy-base"><div id="joy-knob"></div></div>
    <button id="btn" onclick="recover(event)">恢復清醒 (0/3)</button>

    <script>
        let mode = 1; let count = 0;
        const bg = document.getElementById('bg');
        const knob = document.getElementById('joy-knob');
        const base = document.getElementById('joy-base');

        // 時鐘強制跑
        setInterval(() => {
            document.getElementById('clock').innerText = mode ? 
            `14:${Math.floor(Math.random()*60).toString().padStart(2,'0')}:${Math.floor(Math.random()*60).toString().padStart(2,'0')}` : 
            new Date().toLocaleTimeString();
        }, 1000);

        function spawnText(e) {
            if (!mode) return;
            const texts = ["這是哪？", "家在哪...", "好吵", "他是誰？"];
            let d = document.createElement('div');
            d.className = 'whisper'; d.style.left = e.clientX + 'px'; d.style.top = e.clientY + 'px';
            d.innerText = texts[Math.floor(Math.random()*texts.length)];
            document.body.appendChild(d);
            setTimeout(() => d.remove(), 2000);
        }

        // 搖桿邏輯：使用更直接的事件監聽
        base.addEventListener('touchstart', (e) => { e.preventDefault(); }, {passive: false});
        
        base.addEventListener('touchmove', (e) => {
            if (!mode) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = base.getBoundingClientRect();
            // 計算 Y 軸偏移
            let dy = touch.clientY - (rect.top + rect.height / 2);
            dy = Math.max(-45, Math.min(45, dy));
            
            knob.style.transform = `translateY(${dy}px)`;
            
            // 視覺連動
            let intensity = Math.abs(dy) / 45;
            bg.style.transform = `scale(${0.9 + (Math.max(0, -dy)*0.015)})`;
            bg.style.filter = `grayscale(0.5) blur(${2 + intensity*5}px)`;
        }, { passive: false });

        base.addEventListener('touchend', () => {
            knob.style.transform = `translateY(0)`;
        });

        function recover(e) {
            e.stopPropagation();
            count++;
            e.target.innerText = `恢復清醒 (${count}/3)`;
            if (count >= 3) {
                mode = 0;
                document.getElementById('vignette').style.display = 'none';
                bg.style.filter = 'none'; bg.style.transform = 'scale(1)';
                e.target.style.background = '#27ae60'; e.target.innerText = '已恢復';
            }
        }
    </script>
</body>
</html>




