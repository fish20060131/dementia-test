<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8" />
    <title>失智症模擬：穩定 V3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; touch-action: none; font-family: sans-serif; }
        #street-bg {
            position: fixed; width: 100vw; height: 100vh;
            background-image: url('433436.jpg');
            background-size: cover; background-position: center;
            filter: grayscale(0.5) blur(2px); z-index: 1; transform: scale(0.9);
        }
        #vignette { position: fixed; width: 100%; height: 100%; top: 0; left: 0; background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.95) 100%); z-index: 10; pointer-events: none; }
        #anxiety { position: fixed; width: 100%; height: 100%; top: 0; left: 0; background: rgba(255,0,0,0); z-index: 11; pointer-events: none; transition: background 0.2s; }
        #clock { position: fixed; top: 20px; right: 20px; color: #fff; font-size: 1.2rem; z-index: 20; }
        #status { position: fixed; top: 15%; width: 100%; text-align: center; z-index: 2000; color: white; text-shadow: 2px 2px 4px black; pointer-events: none; }
        #joystick-container { position: fixed; bottom: 10%; left: 10%; width: 100px; height: 100px; background: rgba(255,255,255,0.3); border-radius: 50%; z-index: 4000; }
        #joystick-knob { position: absolute; width: 40px; height: 40px; background: #fff; border-radius: 50%; left: 30px; top: 30px; pointer-events: none; }
        #recover-btn { position: fixed; bottom: 10%; right: 10%; padding: 15px 25px; background: #e74c3c; color: white; border: none; border-radius: 50px; z-index: 5000; font-weight: bold; }
        .whisper { position: fixed; color: #fff; z-index: 6000; pointer-events: none; animation: fade 2s forwards; }
        @keyframes fade { 0% { opacity: 1; } 100% { opacity: 0; transform: translateY(-30px); } }
    </style>
</head>
<body onclick="activate(event)">
    <div id="street-bg"></div>
    <div id="vignette"></div>
    <div id="anxiety"></div>
    <div id="clock">--:--:--</div>
    <div id="status">點擊螢幕開始感受...</div>
    <div id="joystick-container"><div id="joystick-knob"></div></div>
    <button id="recover-btn" onclick="toggleMode(event)">恢復清醒 (0/3)</button>

    <script>
        let mode = 1; // 1: 失智, 0: 清醒
        let clicks = 0;
        let audioCtx, osc, gain;

        // 時鐘強制啟動
        setInterval(() => {
            document.getElementById('clock').innerText = mode ? 
                14:${Math.floor(Math.random()*60)}:${Math.floor(Math.random()*60)} : 
                new Date().toLocaleTimeString();
        }, 1000);

        function activate(e) {
            if (!mode) return;
            // 聲音
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                osc = audioCtx.createOscillator();
                gain = audioCtx.createGain();
                osc.type = 'brown';
                osc.connect(gain); gain.connect(audioCtx.destination);
                gain.gain.setValueAtTime(0, audioCtx.currentTime);
                osc.start();
                document.getElementById('status').innerText = "我想往前走...";
            }
            // 文字
            const texts = ["這是哪？", "好吵", "回家", "他是誰？"];
            let d = document.createElement('div');
            d.className = 'whisper'; d.style.left = e.clientX + 'px'; d.style.top = e.clientY + 'px';
            d.innerText = texts[Math.floor(Math.random()*texts.length)];
            document.body.appendChild(d);
            setTimeout(() => d.remove(), 2000);
        }

        const container = document.getElementById('joystick-container');
        const knob = document.getElementById('joystick-knob');
        const bg = document.getElementById('street-bg');

        container.addEventListener('touchmove', (e) => {
            if (!mode) return;
            let touch = e.touches[0];
            let rect = container.getBoundingClientRect();
            let dy = touch.clientY - (rect.top + 50);
            dy = Math.max(-40, Math.min(40, dy));
            knob.style.transform = `translateY(${dy}px)`;
            
            // 視覺連動
            let intensity = Math.abs(dy) / 40;
            bg.style.transform = `scale(${0.9 + (Math.max(0, -dy)*0.01)})`;
            bg.style.filter = `grayscale(0.5) blur(${2 + intensity*5}px)`;
            document.getElementById('anxiety').style.background = `rgba(255,0,0,${intensity*0.4})`;
            if (gain) gain.gain.setTargetAtTime(intensity*0.2, audioCtx.currentTime, 0.1);
        });

        container.addEventListener('touchend', () => {
            knob.style.transform = `translateY(0)`;
            document.getElementById('anxiety').style.background = `rgba(255,0,0,0)`;
            if (gain) gain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.1);
        });

        function toggleMode(e) {
            e.stopPropagation();
            clicks++;
            e.target.innerText = `恢復清醒 (${clicks}/3)`;
            if (clicks >= 3) {
                mode = 0;
                document.getElementById('vignette').style.display = 'none';
                bg.style.filter = 'none';
                bg.style.transform = 'scale(1)';
                document.getElementById('status').innerText = "清醒了。";
                e.target.style.display = 'none'; // 隱藏按鈕避免重複點
            }
        }
    </script>
</body>
</html>



