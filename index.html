<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>歸途：語言的重量</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <style>
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; touch-action: none; font-family: sans-serif; }
        #bg {
            position: fixed; width: 100vw; height: 100vh;
            background-image: url('433436.jpg'); background-position: center; background-size: cover;
            z-index: 1; filter: grayscale(1) blur(20px); transform: scale(1.2);
            transition: all 1.2s cubic-bezier(0.2, 0, 0.2, 1);
        }
        #vignette { position: fixed; width: 100%; height: 100%; top: 0; left: 0; background: radial-gradient(circle, transparent 5%, rgba(0,0,0,0.95) 100%); z-index: 10; pointer-events: none; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; background: #000; color: #fff; transition: opacity 2s; text-align: center; padding: 20px; box-sizing: border-box; }
        .hidden { opacity: 0; pointer-events: none; }
        
        #status-group { position: fixed; top: 8%; width: 100%; text-align: center; z-index: 20; opacity: 0; transition: opacity 1s; }
        #progress-bar { width: 150px; height: 2px; background: rgba(255,255,255,0.1); margin: 10px auto; overflow: hidden; }
        #progress-fill { width: 15%; height: 100%; background: #fff; transition: width 0.8s ease; }
        #status-text { color: rgba(255,255,255,0.5); font-size: 0.7rem; letter-spacing: 4px; }

        #choice-container { position: fixed; bottom: 8%; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 8px; z-index: 1000; opacity: 0; transition: opacity 1s; }
        .choice-btn { width: 85%; max-width: 320px; padding: 14px; background: rgba(255,255,255,0.03); color: #fff; border: 1px solid rgba(255,255,255,0.1); border-radius: 2px; font-size: 0.85rem; text-align: center; transition: 0.3s; }
        .choice-btn:active { background: #fff; color: #000; }

        .whisper { position: fixed; color: #ff3e3e; z-index: 500; pointer-events: none; animation: fadeUp 2s forwards; font-weight: bold; }
        @keyframes fadeUp { 0% { opacity: 0; } 20% { opacity: 1; } 100% { opacity: 0; transform: translateY(-80px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        
        h1 { font-size: 1.5rem; letter-spacing: 8px; margin-bottom: 20px; font-weight: 300; }
        p { font-size: 0.9rem; line-height: 1.8; color: #aaa; }
        .start-hint { margin-top: 50px; font-size: 0.7rem; color: #555; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="cover" class="overlay" onclick="startGame()">
        <h1>歸途</h1>
        <p>語言是橋樑，也可能是圍牆。<br>在破碎的記憶前，<br>請試著溫柔地，接他回家。</p>
        <div class="start-hint">點擊螢幕，踏入迷霧</div>
    </div>

    <div id="bg"></div>
    <div id="vignette"></div>

    <div id="status-group">
        <div id="progress-bar"><div id="progress-fill"></div></div>
        <div id="status-text">當前階段：迷失夜市</div>
    </div>
    <div id="choice-container"></div>

    <div id="end" class="overlay hidden">
        <h1 id="end-title">門開了</h1>
        <p id="end-msg">你找回了名字，也找回了他的尊嚴。<br>雖然清醒只有一瞬，<br>但這份溫柔，會留在記憶的餘燼裡。</p>
        <div class="start-hint" onclick="location.reload()">重新開始</div>
    </div>

    <script>
        let stage = 1;
        let score = 15; // 起始分數調低，拉長遊玩時間
        let isStarted = false;
        const bg = document.getElementById('bg');
        const fill = document.getElementById('progress-fill');
        const container = document.getElementById('choice-container');

        const db = [
            // Stage 1: 夜市 (尋找方向)
            { s: 1, options: [{t: "「我們牽著手慢慢走，不趕時間」", p: 15}, {t: "「到底要在這轉幾圈？快走好嗎」", p: -25}, {t: "「你先冷靜點，這沒什麼好怕的」", p: -8}, {t: "「別亂跑，等下走丟我不管你」", p: -20}] },
            { s: 1, options: [{t: "「肚子餓了嗎？那攤蔥油餅好香」", p: 15}, {t: "「那只是路燈，你不要疑神疑鬼」", p: -12}, {t: "「跟你講多少遍了，路在那邊！」", p: -25}, {t: "「大家都在看你，可以安靜點嗎」", p: -18}] },
            { s: 1, options: [{t: "「我們去那邊坐一下，休息三分鐘」", p: 15}, {t: "「這條路你走三十年了還會迷路？」", p: -25}, {t: "「乖，聽我的話走就對了」", p: -10}, {t: "「你是認真想不起來，還是故意的？」", p: -30}] },
            { s: 1, options: [{t: "「沒關係，我也常忘記這怎麼走」", p: 15}, {t: "「不要亂指！那不是我們的車」", p: -15}, {t: "「為什麼你老是要造成我的困擾？」", p: -25}, {t: "「你到底在找什麼？快點說！」", p: -20}] },

            // Stage 2: 家門口 (找回功能)
            { s: 2, options: [{t: "「慢慢轉，我陪著你一起試試看」", p: 15}, {t: "「這就是你家門！快進去啊」", p: -20}, {t: "「你連鑰匙怎麼拿都忘了嗎？」", p: -30}, {t: "「別鬧了，鄰居都在看了」", p: -15}] },
            { s: 2, options: [{t: "「我們先深呼吸，再試一次」", p: 15}, {t: "「你把鎖弄壞了怎麼辦？別亂扭」", p: -20}, {t: "「你是真的老了，連開門都不會」", p: -35}, {t: "「快點！我很累，我想進去休息」", p: -25}] },
            { s: 2, options: [{t: "「我們一起握著把手，一、二、三」", p: 15}, {t: "「這不是你家難道是我家嗎？」", p: -20}, {t: "「你要在那發呆多久？鑰匙給我」", p: -25}, {t: "「你是不是不想回家？故意在耍賴？」", p: -30}] },
            { s: 2, options: [{t: "「沒關係，這把鑰匙比較難轉」", p: 15}, {t: "「你到底是誰？為什麼站在門口？」", p: -40}, {t: "「進去之後不可以再亂跑了喔」", p: -12}, {t: "「我看你真的是瘋了」", p: -45}] }
        ];

        function startGame() {
            document.getElementById('cover').classList.add('hidden');
            document.getElementById('status-group').style.opacity = "1";
            container.style.opacity = "1";
            isStarted = true;
            updateVisuals();
            loadChoices();
        }

        function loadChoices() {
            container.innerHTML = "";
            let filtered = db.filter(item => item.s === stage);
            // 隨機抽取一組題目
            let group = filtered[Math.floor(Math.random() * filtered.length)];
            
            group.options.sort(() => Math.random() - 0.5).forEach(o => {
                const btn = document.createElement('div');
                btn.className = 'choice-btn';
                btn.innerText = o.t;
                btn.onclick = (e) => { e.stopPropagation(); handleImpact(o.p); };
                container.appendChild(btn);
            });
        }

        function handleImpact(p) {
            score += p;
            score = Math.max(0, Math.min(100, score));
            fill.style.width = score + '%';

            if (p > 0) {
                // 正向：瞬間清晰
                bg.style.filter = "grayscale(0) blur(0px)";
                bg.style.transform = "scale(1)";
                setTimeout(() => updateVisuals(), 1200);
            } else {
                // 負向：壓力爆發
                bg.style.filter = "grayscale(1) blur(25px) brightness(0.4)";
                document.body.style.animation = "shake 0.5s";
                for(let i=0; i<8; i++) spawnWhisper();
                setTimeout(() => { document.body.style.animation = ""; updateVisuals(); }, 1000);
            }

            // --- 兩關平衡邏輯 ---
            // 55分時切換到第二關
            if (score >= 55 && stage === 1) {
                stage = 2;
                bg.style.backgroundImage = "url('433455.jpg')";
                document.getElementById('status-text').innerText = "當前階段：家門口";
            }
            
            if (score >= 100) { showEnding(); } else { loadChoices(); }
        }

        function updateVisuals() {
            let b = (100 - score) / 4.5;
            let g = (100 - score) / 100;
            bg.style.filter = `grayscale(${g}) blur(${b}px)`;
            bg.style.transform = `scale(${1 + (100-score)/400})`;
        }

        function spawnWhisper() {
            const d = document.createElement('div');
            d.className = 'whisper';
            d.style.left = Math.random() * 80 + '%';
            d.style.top = Math.random() * 80 + '%';
            const failTexts = ["別兇我...", "頭好痛", "走開！", "對不起...", "我想不起來", "不要丟下我", "好可怕..."];
            d.innerText = failTexts[Math.floor(Math.random()*failTexts.length)];
            document.body.appendChild(d);
            setTimeout(() => d.remove(), 2000);
        }

        function showEnding() {
            isStarted = false;
            container.style.opacity = "0";
            document.getElementById('status-group').style.opacity = "0";
            bg.style.filter = "none";
            bg.style.transform = "scale(1)";
            setTimeout(() => { document.getElementById('end').classList.remove('hidden'); }, 2000);
        }
    </script>
</body>
</html>




