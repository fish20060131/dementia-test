<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>歸途：對話的選擇</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <style>
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; touch-action: none; font-family: sans-serif; }
        #bg {
            position: fixed; width: 100vw; height: 100vh;
            background-image: url('433436.jpg'); background-position: center; background-size: cover;
            z-index: 1; filter: grayscale(0.8) blur(8px); transform: scale(1.1);
            transition: all 0.8s ease;
        }
        #vignette { position: fixed; width: 100%; height: 100%; top: 0; left: 0; background: radial-gradient(circle, transparent 10%, rgba(0,0,0,0.9) 100%); z-index: 10; pointer-events: none; }
        
        /* 選項容器 */
        #choice-container {
            position: fixed; bottom: 15%; width: 100%; 
            display: flex; flex-direction: column; align-items: center; gap: 15px; z-index: 1000;
        }
        .choice-btn {
            width: 80%; max-width: 300px; padding: 12px;
            background: rgba(0,0,0,0.7); color: #fff;
            border: 1px solid rgba(255,255,255,0.4); border-radius: 10px;
            font-size: 0.95rem; text-align: center; transition: 0.3s;
        }
        .choice-btn:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }

        /* 進度條（理智值） */
        #progress-bar { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); width: 70%; height: 6px; background: rgba(255,255,255,0.2); border-radius: 3px; z-index: 20; overflow: hidden; }
        #progress-fill { width: 30%; height: 100%; background: #3498db; transition: width 0.5s ease; }

        #status { position: fixed; top: 13%; width: 100%; text-align: center; color: #fff; font-size: 0.8rem; z-index: 20; text-shadow: 0 0 5px #000; }
        
        .whisper { position: fixed; color: #ff4d4d; z-index: 500; pointer-events: none; animation: fadeUp 1.5s forwards; font-weight: bold; }
        @keyframes fadeUp { 0% { opacity: 0; } 20% { opacity: 1; } 100% { opacity: 0; transform: translateY(-50px); } }
    </style>
</head>
<body>
    <div id="bg"></div>
    <div id="vignette"></div>
    <div id="progress-bar"><div id="progress-fill"></div></div>
    <div id="status">捕捉意識中...</div>
    
    <div id="choice-container"></div>

    <script>
        let stage = 1;
        let score = 30; // 初始理智值
        const bg = document.getElementById('bg');
        const fill = document.getElementById('progress-fill');
        const container = document.getElementById('choice-container');

        // 題目庫：正分（幫助）與負分（無助）
        const questions = [
            { s: 1, q: [ {t: "「放輕鬆，我們慢慢走」", p: 20}, {t: "「你怎麼又忘了路？」", p: -15} ] },
            { s: 1, q: [ {t: "「我們去吃你最愛的點心」", p: 20}, {t: "「快一點，大家在等你」", p: -15} ] },
            { s: 2, q: [ {t: "「沒關係，鑰匙慢慢找」", p: 20}, {t: "「這就是你家啊！快開門」", p: -25} ] },
            { s: 2, q: [ {t: "「我陪在你身邊，別擔心」", p: 20}, {t: "「你到底在搞什麼？」", p: -25} ] }
        ];

        function loadQuestion() {
            container.innerHTML = "";
            let currentQ = questions.filter(item => item.s === stage);
            let qData = currentQ[Math.floor(Math.random() * currentQ.length)];
            
            // 隨機排序選項
            qData.q.sort(() => Math.random() - 0.5).forEach(choice => {
                const btn = document.createElement('div');
                btn.className = 'choice-btn';
                btn.innerText = choice.t;
                btn.onclick = () => handleChoice(choice.p);
                container.appendChild(btn);
            });
        }

        function handleChoice(p) {
            score += p;
            if (score < 0) score = 0;
            if (score > 100) score = 100;
            
            fill.style.width = score + '%';

            if (p > 0) {
                // 正確回饋：畫面變清晰彩色
                bg.style.filter = "grayscale(0) blur(0px)";
                bg.style.transform = "scale(1)";
                setTimeout(() => updateEnvironment(), 1000);
            } else {
                // 錯誤回饋：畫面劇烈震動
                bg.style.filter = "grayscale(1) blur(15px)";
                document.body.style.animation = "shake 0.3s infinite";
                for(let i=0; i<5; i++) createWhisper();
                setTimeout(() => {
                    document.body.style.animation = "";
                    updateEnvironment();
                }, 800);
            }

            // 判斷關卡切換
            if (score >= 60 && stage === 1) {
                stage = 2;
                bg.style.backgroundImage = "url('433455.jpg')";
                document.getElementById('status').innerText = "抵達門口了...";
            }
            
            if (score >= 100) {
                finish();
            } else {
                loadQuestion();
            }
        }

        function updateEnvironment() {
            let blurVal = (100 - score) / 10;
            let grayVal = (100 - score) / 100;
            bg.style.filter = `grayscale(${grayVal}) blur(${blurVal}px)`;
            bg.style.transform = `scale(${0.9 + score/1000})`;
        }

        function createWhisper() {
            const div = document.createElement('div');
            div.className = 'whisper';
            div.style.left = Math.random() * 80 + '%';
            div.style.top = Math.random() * 80 + '%';
            div.innerText = stage === 1 ? "好混亂..." : "打不開！";
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 1500);
        }

        function finish() {
            container.innerHTML = "";
            bg.style.filter = "none";
            bg.style.transform = "scale(1)";
            document.getElementById('status').innerText = "意識終於清醒了。";
            const btn = document.createElement('div');
            btn.className = 'choice-btn';
            btn.style.borderColor = "#27ae60";
            btn.innerText = "重新找回記憶";
            btn.onclick = () => location.reload();
            container.appendChild(btn);
        }

        // CSS 震動效果
        const style = document.createElement('style');
        style.innerHTML = `@keyframes shake { 0% { left: 0; } 25% { left: 5px; } 50% { left: -5px; } 75% { left: 5px; } 100% { left: 0; } }`;
        document.head.appendChild(style);

        loadQuestion();
    </script>
</body>
</html>


