<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>感知模擬：夜市與家門</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <style>
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; touch-action: none; -webkit-user-select: none; font-family: sans-serif; }
        
        /* 背景圖層 */
        #bg {
            position: fixed; width: 100vw; height: 100vh;
            background-image: url('433436.jpg'); /* 初始第一關：夜市 */
            background-repeat: no-repeat; background-position: center; background-size: cover;
            z-index: 1; filter: grayscale(0.5) blur(2px); transform: scale(0.9);
            transition: background-image 1s ease-in-out, filter 0.5s, transform 0.5s;
        }

        #vignette { position: fixed; width: 100%; height: 100%; top: 0; left: 0; background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.95) 100%); z-index: 10; pointer-events: none; }
        #clock { position: fixed; top: 20px; right: 20px; color: #fff; font-size: 1.2rem; z-index: 20; }
        #status { position: fixed; top: 15%; width: 100%; text-align: center; color: white; z-index: 20; text-shadow: 2px 2px 4px #000; pointer-events: none; }
        
        /* 搖桿 */
        #joy-base { position: fixed; bottom: 12%; left: 10%; width: 100px; height: 100px; background: rgba(255,255,255,0.2); border-radius: 50%; z-index: 999; border: 2px solid #fff; }
        #joy-knob { position: absolute; width: 40px; height: 40px; background: #fff; border-radius: 50%; left: 30px; top: 30px; pointer-events: none; }
        
        /* 隨機瞬移按鈕 */
        #btn { 
            position: fixed; bottom: 12%; right: 10%; 
            padding: 12px 20px; background: #e74c3c; 
            color: white; border: 2px solid #fff; border-radius: 50px; 
            z-index: 1000; font-weight: bold;
            transition: all 0.25s ease-out;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }

        .whisper { position: fixed; color: #fff; z-index: 500; pointer-events: none; animation: fadeUp 2s forwards; font-weight: bold; text-shadow: 1px 1px 3px #000; }
        @keyframes fadeUp { 0% { opacity: 0; transform: translateY(0); } 20% { opacity: 1; } 100% { opacity: 0; transform: translateY(-40px); } }
    </style>
</head>
<body id="main">
    <div id="bg"></div>
    <div id="vignette"></div>
    <div id="clock">--:--:--</div>
    <div id="status">第一關：混亂的夜市</div>
    <div id="joy-base"><div id="joy-knob"></div></div>
    <button id="btn" onclick="recover(event)">找回意識 (0/3)</button>

    <script>
        let isDementia = true;
        let count = 0;
        let stage = 1; // 1: 夜市, 2: 門口
        
        const texts1 = ["好吵...", "這是哪？", "路口在哪？", "東西呢？"];
        const texts2 = ["鑰匙呢？", "這是我家嗎？", "門牌看不清...", "想進去..."];

        // 1. 碎念文字
        window.addEventListener('touchstart', (e) => {
            if (!isDementia || e.target.id === 'btn' || e.target.id === 'joy-base') return;
            const div = document.createElement('div');
            div.className = 'whisper';
            div.style.left = e.touches[0].clientX + 'px';
            div.style.top = e.touches[0].clientY + 'px';
            div.innerText = (stage === 1) ? texts1[Math.floor(Math.random()*texts1.length)] : texts2[Math.floor(Math.random()*texts2.length)];
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 2000);
        });

        // 2. 時鐘亂跳
        setInterval(() => {
            const clockEl = document.getElementById('clock');
            if (isDementia) {
                clockEl.innerText = `14:${Math.floor(Math.random()*60).toString().padStart(2,'0')}:${Math.floor(Math.random()*60).toString().padStart(2,'0')}`;
            } else {
                clockEl.innerText = new Date().toLocaleTimeString('zh-TW', {hour12:false});
            }
        }, 1000);

        // 3. 搖桿縮放
        const bg = document.getElementById('bg');
        const knob = document.getElementById('joy-knob');
        const base = document.getElementById('joy-base');

        base.addEventListener('touchmove', (e) => {
            if (!isDementia) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = base.getBoundingClientRect();
            let dy = touch.clientY - (rect.top + 50);
            dy = Math.max(-45, Math.min(45, dy));
            knob.style.transform = `translateY(${dy}px)`;
            
            let intensity = Math.abs(dy) / 45;
            bg.style.filter = `grayscale(0.5) blur(${2 + intensity * 6}px)`;
            bg.style.transform = `scale(${0.9 + (Math.max(0, -dy) * 0.02)})`;
        }, {passive: false});

        base.addEventListener('touchend', () => { knob.style.transform = `translateY(0)`; });

        // 4. 關卡與按鈕瞬移邏輯
        function recover(e) {
            e.stopPropagation();
            count++;
            const b = e.target;
            
            if (count < 3) {
                // 按鈕瞬移
                b.innerText = `找回意識 (${count}/3)`;
                b.style.left = (10 + Math.random() * 60) + '%';
                b.style.top = (10 + Math.random() * 70) + '%';
                b.style.bottom = 'auto'; b.style.right = 'auto';
                
                bg.style.filter = `grayscale(0.5) blur(12px)`;
                setTimeout(() => { if(isDementia) bg.style.filter = `grayscale(0.5) blur(2px)`; }, 400);

            } else if (stage === 1) {
                // 第一關結束，進入第二關
                stage = 2;
                count = 0; // 重置點擊次數
                document.getElementById('status').innerText = "第二關：熟悉的家門？";
                b.innerText = "捕捉記憶 (0/3)";
                b.style.background = "#3498db"; // 換個顏色提醒進入下一關
                
                // 更換背景圖為門口
                bg.style.filter = "grayscale(1) blur(20px)"; // 切換瞬間極度模糊
                setTimeout(() => {
                    bg.style.backgroundImage = "url('433455.jpg')";
                    bg.style.filter = "grayscale(0.5) blur(2px)";
                }, 500);

            } else {
                // 全部通關
                isDementia = false;
                bg.style.transition = "all 1.5s ease-in-out";
                bg.style.filter = "none";
                bg.style.transform = "scale(1)";
                document.getElementById('vignette').style.opacity = '0';
                document.getElementById('status').innerText = "意識終於清醒了。";
                base.style.display = 'none';
                
                b.style.left = '50%'; b.style.top = '50%';
                b.style.transform = 'translate(-50%, -50%)';
                b.style.background = "#27ae60";
                b.innerText = "重新進入模擬";
                
                if (count > 3) location.reload();
            }
        }
    </script>
</body>
</html>

