<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>失智症感知模擬：意識捕捉版</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <style>
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; overflow: hidden; 
            touch-action: none; -webkit-user-select: none; 
            font-family: sans-serif; 
        }
        
        #bg {
            position: fixed; width: 100vw; height: 100vh;
            /* 將背景圖片檔名統一為是用戶上傳圖片 433455.jpg */
            background: url('433455.jpg') no-repeat center bottom;
            background-size: cover; 
            /* 模擬：模糊+灰色。視覺呈現高模糊度、灰色 */
            filter: grayscale(0.5) blur(2px); 
            z-index: 1; 
            /* 視覺比例優化：初始縮小一點，讓你感覺照片沒那麼大 */
            transform: scale(0.8);
            /* 焦慮泛紅層過渡 */
            transition: transform 0.1s linear, filter 0.3s;
        }

        /* 隧道視野遮罩和焦慮泛紅層 */
        #vignette { 
            position: fixed; width: 100%; height: 100%; top: 0; left: 0; 
            /* 畫面邊緣被黑色陰影籠罩。畫面邊緣有隧道視野遮罩，使觀測者產生孤立感與壓迫感 */
            background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.95) 100%); 
            z-index: 10; pointer-events: none; 
            transition: opacity 0.5s;
        }
        
        /* 焦慮泛紅層 */
        #anxiety { 
            position: fixed; width: 100%; height: 100%; top: 0; left: 0; 
            /* 當搖桿操作過於劇烈，畫面會泛紅 */
            background: rgba(255,0,0,0); 
            z-index: 11; pointer-events: none; 
            transition: background 0.2s; 
        }

        /* 時鐘顯示：秒數會隨機跳動 */
        #clock { position: fixed; top: 20px; right: 20px; color: #fff; font-size: 1.2rem; z-index: 20; }
        
        #status { 
            position: fixed; top: 15%; width: 100%; 
            text-align: center; z-index: 2000; 
            color: white; text-shadow: 2px 2px 4px black; 
            pointer-events: none; 
        }
        
        /* 操縱桿底座樣式：阻尼感，模擬指令遲鈍 */
        #joy-base { 
            position: fixed; bottom: 12%; left: 10%; 
            width: 100px; height: 100px; 
            background: rgba(255,255,255,0.2); border-radius: 50%; 
            z-index: 4000; border: 2px solid rgba(255,255,255,0.3); 
        }
        
        #joy-knob { 
            position: absolute; width: 40px; height: 40px; 
            background: #fff; border-radius: 50%; 
            left: 30px; top: 30px; pointer-events: none; 
        }
        
        /* 「恢復清醒」按鈕邏輯 */
        #btn { 
            position: fixed; 
            /* 用戶連按按鈕需要連續點擊三次才能生效。初始位置 */
            bottom: 12%; right: 10%; 
            padding: 12px 20px; background: #e74c3c; 
            color: white; border: 2px solid #fff; border-radius: 50px; 
            z-index: 5000; font-weight: bold;
            transition: all 0.2s ease-out; /* 按鈕移動平滑感 */
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }

        /* 碎念文字樣式。繞著使用者，並具有隨機縮放、旋轉效果 */
        .whisper { 
            position: fixed; color: rgba(255,255,255,0.4); z-index: 15; 
            pointer-events: none; animation: fadeout 2s forwards; 
            text-shadow: 1px 1px 3px #000; 
        }
        @keyframes fadeout { 
            from { opacity: 1; transform: scale(1) rotate(0deg); } 
            to { opacity: 0; transform: scale(1.2) rotate(15deg); } 
        }
    </style>
</head>
<body id="main" onclick="spawnWhisper(event)">
    <div id="bg"></div>
    <div id="vignette"></div>
    <div id="anxiety"></div>
    <div id="clock">14:23:05</div>
    <div id="status">點擊螢幕開啟感知...</div>
    <div id="joy-base"><div id="joy-knob"></div></div>
    <button id="btn" onclick="recover(event)">找回意識 (0/3)</button>

    <script>
        let isDementia = true;
        let recoverCount = 0;
        let audioCtx, osc, gain;
        let targetScale = 0.8, currentScale = 0.8;
        let targetBlur = 2, currentBlur = 2;

        const bg = document.getElementById('bg');
        const knob = document.getElementById('joy-knob');
        const base = document.getElementById('joy-base');
        const anxiety = document.getElementById('anxiety');
        const status = document.getElementById('status');
        const btn = document.getElementById('btn');

        // 碎念文字列表：包含新場景相關文字 
        const texts = [
            "這條街...剛才走過嗎？", 
            "紅綠燈...是什麼顏色？", 
            "家門口有棵樹...樹呢？", 
            "那是誰？很面善...", 
            "家門口有棵樹...樹呢？",
            "家在哪個方向？",
            "東西呢？我的袋子呢？",
            "慢...為什麼要慢？"
        ];

        // 碎念文字彈出邏輯
        function spawnWhisper(e) {
            if (!isDementia || e.target.id === 'btn' || e.target.id === 'joy-base') return;
            
            // 聲音初始化
            if (!audioCtx) initAudio();
            
            const div = document.createElement('div');
            div.className = 'whisper';
            
            // 碎念內容 
            const fontSize = 0.8 + Math.random() * 0.7; // 隨機大小
            const rotation = (Math.random() - 0.5) * 30; // 隨機旋轉
            
            div.style.left = e.clientX + 'px';
            div.style.top = e.clientY + 'px';
            div.style.fontSize = `${fontSize}rem`;
            div.style.transform = `rotate(${rotation}deg)`;
            div.innerText = texts[Math.floor(Math.random() * texts.length)];
            document.body.appendChild(div);
            
            // 2.5秒後自動移除
            setTimeout(() => div.remove(), 2500);
        }

        function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            osc = audioCtx.createOscillator();
            gain = audioCtx.createGain();
            osc.type = 'brown';
            osc.connect(gain); gain.connect(audioCtx.destination);
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            osc.start();
            status.innerText = "我想往前走...但手不聽使喚...";
        }

        // 時鐘亂跳邏輯
        setInterval(() => {
            const clockEl = document.getElementById('clock');
            if (isDementia) {
                // 秒數會隨機跳動 
                clockEl.innerText = `14:${Math.floor(Math.random()*60).toString().padStart(2,'0')}:${Math.floor(Math.random()*60).toString().padStart(2,'0')}`;
            } else {
                clockEl.innerText = new Date().toLocaleTimeString('zh-TW', {hour12:false});
            }
        }, 1000);

        // 操縱桿向上推時，背景會縮放和模糊
        base.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = base.getBoundingClientRect();
            // 計算垂直偏移 
            let dy = touch.clientY - (rect.top + rect.height / 2);
            dy = Math.max(-45, Math.min(45, dy));
            
            knob.style.transform = `translateY(${dy}px)`;
            
            if (isDementia) {
                // 向上推操縱桿時，背景圖片逐漸放大（吞噬感）和模糊（視覺對焦能力的喪失），視覺呈現高模糊度、灰色。畫面邊緣呈現隧道視野遮罩，使觀測者產生孤立感與壓迫感。向上推操縱桿時，背景會逐漸放大（吞噬感），模糊度也會增加，模擬執行力下降和視覺對焦能力的喪失。 向上推動操縱桿時，背景圖片逐漸放大（吞噬感）和模糊（視覺對焦能力的喪失）。視覺呈現高模糊度、灰色。畫面邊緣呈現隧道視野遮罩，使觀測者產生孤立感與壓迫感。向上推動操縱桿時，背景會縮放和模糊。操縱桿向上推時背景會逐漸放大，模糊度也會增加。視覺比例優化：設置背景圖片顯示為是用戶感覺照片沒那麼大。背景圖片從頂部對齊以便顯示更多细节。碎念文字彈出邏輯。時鐘亂跳邏輯。搖桿操作過於劇烈，畫面會泛紅。向上推操縱桿時背景會逐漸放大（吞噬感）。模糊度會增加（視覺對焦能力的喪失）。視覺比例優化：背景被設置為是用戶感覺照片沒那麼大。背景被設置為是用戶上傳的直式照片比例。 
                targetScale = 0.8 + (Math.max(0, -dy) * 0.015);
                targetBlur = 2 + (Math.abs(dy) * 0.15);
                
                // 焦慮泛紅與聲音強度 
                let intensity = Math.abs(dy) / 45;
                anxiety.style.background = `rgba(255, 0, 0, ${intensity * 0.4})`;
                if (gain) gain.gain.setTargetAtTime(intensity * 0.2, audioCtx.currentTime, 0.1);
            }
        }, { passive: false });

        base.addEventListener('touchend', () => {
            // 操縱桿回到中央 
            knob.style.transform = `translateY(0)`;
            anxiety.style.background = `rgba(255, 0, 0, 0)`;
            if (gain) gain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.1);
        });

        // 視覺連動動畫迴圈
        function animate() {
            currentScale += (targetScale - currentScale) * 0.05;
            currentBlur += (targetBlur - currentBlur) * 0.05;
            bg.style.transform = `scale(${currentScale})`;
            bg.style.filter = isDementia ? `grayscale(0.5) blur(${currentBlur}px)` : "none";
            requestAnimationFrame(animate);
        }
        animate();

        // 按鈕在點擊前兩次時會瞬移
        function recover(e) {
            e.stopPropagation();
            recoverCount++;
            
            if (recoverCount < 3) {
                // 找回意識計數，連續點擊三次才能生效 
                btn.innerText = `找回意識 (${recoverCount}/3)`;
                
                // 按鈕瞬移邏輯 
                const newX = 10 + Math.random() * 60; // 10% ~ 70% 寬度 
                const newY = 10 + Math.random() * 70; // 10% ~ 80% 高度 
                
                // 物理清除初始位置設置 
                btn.style.left = newX + '%';
                btn.style.top = newY + '%';
                btn.style.bottom = 'auto'; 
                btn.style.right = 'auto';  
                
                // 短暫加深背景模糊以模擬努力後的疲勞 爆發性模糊 爆發性模糊爆發性模糊
                bg.style.filter = `grayscale(0.5) blur(10px)`;
                setTimeout(() => { if(isDementia) bg.style.filter = `grayscale(0.5) blur(2px)`; }, 300);

            } else {
                // 第三次點擊恢復清醒，背景變清晰 
                isDementia = false;
                // 成功找回意識。背景圖片變清晰，灰色濾鏡移除，遮罩移除，操縱桿移除 
                bg.style.transition = "all 1.2s ease-in-out";
                bg.style.filter = "none";
                bg.style.transform = "scale(1)";
                // 用戶上傳的是直式照片比例。背景檔名統一為 433455.jpg。視覺比例優化。隧道視野遮罩。焦慮震動。亂跳的時鐘。大腦內部的碎念對話。點擊螢幕會跳出與新場景相關詞組。恢復清醒需要連續點擊三次才能生效。向上推操縱桿時，背景圖片逐漸放大和模糊。背景呈現高模糊度、灰色。隧道視野遮罩。
                document.getElementById('vignette').style.opacity = '0';
                base.style.display = 'none';
                
                // 按鈕移到螢幕中央 
                btn.style.left = '50%';
                btn.style.top = '50%';
                btn.style.transform = 'translate(-50%, -50%)';
                btn.style.background = "#27ae60";
                btn.innerText = "清醒了 (點擊重新進入)";
                
                if (recoverCount > 3) location.reload();
            }
        }
    </script>
</body>
</html>

